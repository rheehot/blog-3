
<!DOCTYPE html>
<html lang="en">
    

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="아내와 아들 그리고 딸밖에 모르는 남편">
    <title>
        어서와, Memory Leak은 처음이지? - 아내와 아들 그리고 딸밖에 모르는 남편
    </title>
    <meta name="author" content="sculove">
    
    <meta name="keywords" content="frontend,javascript,developer,">
    
    
    
    <link rel="alternate" type="application/atom+xml" title="RSS" href="/blog/rss2.xml">
    
    <link rel="canonical" href="http://sculove.github.io/blog/2019/06/09/nodejs-memoryleak/">
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"sculove","sameAs":["https://github.com/sculove","https://www.facebook.com/chanuk.son","https://kr.linkedin.com/in/chan-uk-son-8989ba56","mailto:sculove@gmail.com"],"image":"sculove.jpeg"},"articleBody":"Node 기반의 SSR(Server Side Rendering) 랜더링 을 서비스에 도입하다 Memory Leak 이슈를 맞이했다.Java 환경의 성능테스트를 준비하면 간혹 겪게되는 이슈이긴 한데. Node.js 도입 시작부터 memory leak 이슈가 튀어나와서 사실 당황스럽긴했다.\nMemory Leak 현상 감지하기트래픽이 중요한 서비스다 보니 성능검증을 하지 않을 수 없었다.보통 서버에 부하를 주게되면 최고 TPS를 찍은 후 유지된다. 요렇게.\n\n그런데, 실제 부하테스트를 해보니 다음과 같은 TPS 그래프가 나왔다.\n\n\n시간이 지날수록 TPS는 떨어지고,\n\nnode instance가 사용하는 메모리도 점점 차올랐다.\n\n힙 메모리 프로파일하기전형적인 Memory Leak 패턴이었다. 그래서 Profile을 해봤다.“Allocation instrumentation on timeline” 을 이용하면 실시간으로 메모리가 릴리즈 되지 못하고 누적되는 것을 손쉽게 확인할 수 있다.\n\n\n\nMemory Leak을 찾는 방법에 대해서는 전에 작성한 다음의 발표자료를 참고해라.\nChrome Devtools를 이용한 Web Application Memory 분석법\n\nProfile의 상세 내역을 보면 클라이언트 요청시마다 생성되는 ServerResponse 객체가 누적되고 있는 것을 확인해 볼 수 있다.\n\n찾았다. 요놈 ㅋㅋㅋ\nMemory Leak 제거하기문제가 된 코드는 단 한줄의 코드였다.\n12// The request handler must be the first middleware on the appapp.use(handlers.requestHandler());\n\n\nSentry Express 적용 가이드 https://docs.sentry.io/platforms/node/express/\n\nexpress의 에러감지를 위해 적용해 놓은 sentry의 Sentry.Handlers.requestHandler 에서 Memory Leak이 발생한 것이었다.Sentry 코드의 내용을 확인해보면 Node.js의 domain 객체를 사용하는 간단한 코드로 구성되어 있다.\n12345678910export function requestHandler(options) &#123;    // ...    const local = domain.create();    local.add(req);    local.add(res);    local.on('error', next);    local.run(() =&gt; &#123;       // ...    &#125;);&#125;\n\n\nhttps://github.com/getsentry/sentry-javascript/blob/master/packages/node/src/handlers.ts#L233-L255\n\nNode.js의 domain 객체에서 Memory Leak을 유발하는 코드가 있어서 위와 같은 문제가 발생한다.Node.js 11.10.0 릴리즈 노트를 확인하시면 domain의 Memory Leak 이슈가 해결된 커멘트를 확인해 볼 수 있다.\n\n[60c5099f4b] - domain: avoid circular memory references (Anna Henningsen) #25993\n\nNode.js 11.10.0에서는 domain 객체의 Memory Leak 문제가 해결되었으나 아직 Node.js 의 LTS 버전은 10.x.x 이기에 사실상 서비스에서는 Sentry.Handlers.requestHandler를 사용할 수 없었다.결과적으로는 Request Header 정보는 서비스 오류, 장애 대응에 크게 문제가 되지 않기에 Express의 Sentry 탐침 코드를 제거하였다.\n\n참고로 Sentry.Handlers.requestHandler를 적용하지 않으면 아래와 같은 Request Header 정보를 Sentry에서 확인 할 수 없다.\n\n\n결론1. Sentry를 사용한다면…\nNode.js 11.10.0 미만에서는 Sentry.Handlers.requestHandler를 사용하지 않는다.\nNode.js 11.10.0 이상에서는 Sentry.Handlers.requestHandler를 사용한다.\n\n2. node.js 11.10.0 미만 버전에서 domain 객체를 사용하지 않는다.\n참고로 Node.js의 domain 객체는 node.js 10.x.x에서 deprecated 되었다.\n\n","dateCreated":"2019-06-09T12:48:11+09:00","dateModified":"2019-09-22T11:02:02+09:00","datePublished":"2019-06-09T12:48:11+09:00","description":"Node 기반의 SSR(Server Side Rendering) 랜더링 을 서비스에 도입하다 Memory Leak 이슈를 맞이했다.Java 환경의 성능테스트를 준비하면 간혹 겪게되는 이슈이긴 한데. Node.js 도입 시작부터 memory leak 이슈가 튀어나와서 사실 당황스럽긴했다.\nMemory Leak 현상 감지하기트래픽이 중요한 서비스다 보니 성능검증을 하지 않을 수 없었다.보통 서버에 부하를 주게되면 최고 TPS를 찍은 후 유지된다. 요렇게.\n\n그런데, 실제 부하테스트를 해보니 다음과 같은 TPS 그래프가 나왔다.","headline":"어서와, Memory Leak은 처음이지?","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"http://sculove.github.io/blog/2019/06/09/nodejs-memoryleak/"},"publisher":{"@type":"Organization","name":"sculove","sameAs":["https://github.com/sculove","https://www.facebook.com/chanuk.son","https://kr.linkedin.com/in/chan-uk-son-8989ba56","mailto:sculove@gmail.com"],"image":"sculove.jpeg","logo":{"@type":"ImageObject","url":"sculove.jpeg"}},"url":"http://sculove.github.io/blog/2019/06/09/nodejs-memoryleak/","keywords":"performance, nodejs, SSR, memoryleak, sentry"}</script>
    <meta name="description" content="Node 기반의 SSR(Server Side Rendering) 랜더링 을 서비스에 도입하다 Memory Leak 이슈를 맞이했다.Java 환경의 성능테스트를 준비하면 간혹 겪게되는 이슈이긴 한데. Node.js 도입 시작부터 memory leak 이슈가 튀어나와서 사실 당황스럽긴했다. Memory Leak 현상 감지하기트래픽이 중요한 서비스다 보니 성능검">
<meta name="keywords" content="performance,nodejs,SSR,memoryleak,sentry">
<meta property="og:type" content="blog">
<meta property="og:title" content="어서와, Memory Leak은 처음이지?">
<meta property="og:url" content="http://sculove.github.io/blog/2019/06/09/nodejs-memoryleak/index.html">
<meta property="og:site_name" content="아내와 아들 그리고 딸밖에 모르는 남편">
<meta property="og:description" content="Node 기반의 SSR(Server Side Rendering) 랜더링 을 서비스에 도입하다 Memory Leak 이슈를 맞이했다.Java 환경의 성능테스트를 준비하면 간혹 겪게되는 이슈이긴 한데. Node.js 도입 시작부터 memory leak 이슈가 튀어나와서 사실 당황스럽긴했다. Memory Leak 현상 감지하기트래픽이 중요한 서비스다 보니 성능검">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://sculove.github.io/blog/2019/06/09/nodejs-memoryleak/normal-tps.png">
<meta property="og:image" content="http://sculove.github.io/blog/2019/06/09/nodejs-memoryleak/memoryleak-tps.png">
<meta property="og:image" content="http://sculove.github.io/blog/2019/06/09/nodejs-memoryleak/memoryleak.png">
<meta property="og:image" content="http://sculove.github.io/blog/2019/06/09/nodejs-memoryleak/profile-timeline.png">
<meta property="og:image" content="http://sculove.github.io/blog/2019/06/09/nodejs-memoryleak/serverResponse.png">
<meta property="og:image" content="http://sculove.github.io/blog/2019/06/09/nodejs-memoryleak/requestheader.png">
<meta property="og:updated_time" content="2019-09-22T02:02:02.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="어서와, Memory Leak은 처음이지?">
<meta name="twitter:description" content="Node 기반의 SSR(Server Side Rendering) 랜더링 을 서비스에 도입하다 Memory Leak 이슈를 맞이했다.Java 환경의 성능테스트를 준비하면 간혹 겪게되는 이슈이긴 한데. Node.js 도입 시작부터 memory leak 이슈가 튀어나와서 사실 당황스럽긴했다. Memory Leak 현상 감지하기트래픽이 중요한 서비스다 보니 성능검">
<meta name="twitter:image" content="http://sculove.github.io/blog/2019/06/09/nodejs-memoryleak/normal-tps.png">
    
    
    
    
    
    <meta property="og:image" content="http://sculove.github.io/blog/assets/images/sculove.jpeg">
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/blog/assets/css/all.css">
    <link rel="stylesheet" href="/blog/assets/css/jquery.fancybox.css">
    <link rel="stylesheet" href="/blog/assets/css/thumbs.css">
    <link rel="stylesheet" href="/blog/assets/css/tranquilpeak.css">
    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-37362821-12"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-37362821-12');
    </script>


    
</head>
    <body>
        <div id="blog">
            <!-- Define author's picture -->


<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/blog/ ">아내와 아들 그리고 딸밖에 모르는 남편</a>
    </div>
    
        
            <a class="header-right-icon open-algolia-search" href="#search">
        
        
            <i class="fa fa-search fa-lg"></i>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/blog/#about">
                    <img class="sidebar-profile-picture" src="/blog/assets/images/sculove.jpeg" alt="Author&#39;s picture">
                </a>
                <h4 class="sidebar-profile-name">sculove</h4>
                
                    <h5 class="sidebar-profile-bio"><p>아내와 아들 그리고 딸밖에 모르는 남편</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/blog/ " title="Home">
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/blog/all-categories" title="Categories">
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/blog/all-tags" title="Tags">
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/blog/all-archives" title="Archives">
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link open-algolia-search" href="#search" title="Search">
                    
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="#about" title="About">
                    
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://github.com/sculove" target="_blank" rel="external nofollow noopener noreferrer" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://www.facebook.com/chanuk.son" target="_blank" rel="external nofollow noopener noreferrer" title="Facebook">
                    
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://kr.linkedin.com/in/chan-uk-son-8989ba56" target="_blank" rel="external nofollow noopener noreferrer" title="LinkedIn">
                    
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="mailto:sculove@gmail.com" target="_blank" rel="external nofollow noopener noreferrer" title="Mail">
                    
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://sculove.github.io/blog/rss2.xml" target="_blank" rel="noopener" title="RSS">
                    
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4" class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
    <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            어서와, Memory Leak은 처음이지?
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2019-06-09T12:48:11+09:00">
	
		    Jun 09, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/blog/categories/Tech/">Tech</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p><strong>Node 기반의 SSR(Server Side Rendering) 랜더링</strong> 을 서비스에 도입하다 Memory Leak 이슈를 맞이했다.<br>Java 환경의 성능테스트를 준비하면 간혹 겪게되는 이슈이긴 한데. Node.js 도입 시작부터 memory leak 이슈가 튀어나와서 사실 당황스럽긴했다.</p>
<h3 id="Memory-Leak-현상-감지하기"><a href="#Memory-Leak-현상-감지하기" class="headerlink" title="Memory Leak 현상 감지하기"></a>Memory Leak 현상 감지하기</h3><p>트래픽이 중요한 서비스다 보니 성능검증을 하지 않을 수 없었다.<br>보통 서버에 부하를 주게되면 최고 TPS를 찍은 후 유지된다. 요렇게.</p>
<img src="/blog/2019/06/09/nodejs-memoryleak/normal-tps.png">
<p>그런데, 실제 부하테스트를 해보니 다음과 같은 TPS 그래프가 나왔다.</p>
<a id="more"></a>

<h5 id="시간이-지날수록-TPS는-떨어지고"><a href="#시간이-지날수록-TPS는-떨어지고" class="headerlink" title="시간이 지날수록 TPS는 떨어지고,"></a><strong>시간이 지날수록 TPS는 떨어지고,</strong></h5><img src="/blog/2019/06/09/nodejs-memoryleak/memoryleak-tps.png">

<h5 id="node-instance가-사용하는-메모리도-점점-차올랐다"><a href="#node-instance가-사용하는-메모리도-점점-차올랐다" class="headerlink" title="node instance가 사용하는 메모리도 점점 차올랐다."></a><strong>node instance가 사용하는 메모리도 점점 차올랐다.</strong></h5><img src="/blog/2019/06/09/nodejs-memoryleak/memoryleak.png">

<h3 id="힙-메모리-프로파일하기"><a href="#힙-메모리-프로파일하기" class="headerlink" title="힙 메모리 프로파일하기"></a>힙 메모리 프로파일하기</h3><p>전형적인 <code>Memory Leak</code> 패턴이었다. 그래서 Profile을 해봤다.<br><strong>“Allocation instrumentation on timeline”</strong> 을 이용하면 실시간으로 메모리가 릴리즈 되지 못하고 누적되는 것을 손쉽게 확인할 수 있다.</p>
<img src="/blog/2019/06/09/nodejs-memoryleak/profile-timeline.png">

<blockquote>
<p>Memory Leak을 찾는 방법에 대해서는 전에 작성한 다음의 발표자료를 참고해라.</p>
<a href="/blog/2016/10/06/memory/" title="Chrome Devtools를 이용한 Web Application Memory 분석법">Chrome Devtools를 이용한 Web Application Memory 분석법</a>
</blockquote>
<p>Profile의 상세 내역을 보면 클라이언트 요청시마다 생성되는 <code>ServerResponse</code> 객체가 누적되고 있는 것을 확인해 볼 수 있다.</p>
<img src="/blog/2019/06/09/nodejs-memoryleak/serverResponse.png">
<p>찾았다. 요놈 ㅋㅋㅋ</p>
<h3 id="Memory-Leak-제거하기"><a href="#Memory-Leak-제거하기" class="headerlink" title="Memory Leak 제거하기"></a>Memory Leak 제거하기</h3><p>문제가 된 코드는 단 한줄의 코드였다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The request handler must be the first middleware on the app</span></span><br><span class="line">app.use(handlers.requestHandler());</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Sentry Express 적용 가이드 <a href="https://docs.sentry.io/platforms/node/express/" rel="external nofollow noopener noreferrer" target="_blank">https://docs.sentry.io/platforms/node/express/</a></p>
</blockquote>
<h5 id="express의-에러감지를-위해-적용해-놓은-sentry의-Sentry-Handlers-requestHandler-에서-Memory-Leak이-발생한-것이었다"><a href="#express의-에러감지를-위해-적용해-놓은-sentry의-Sentry-Handlers-requestHandler-에서-Memory-Leak이-발생한-것이었다" class="headerlink" title="express의 에러감지를 위해 적용해 놓은 sentry의 Sentry.Handlers.requestHandler 에서 Memory Leak이 발생한 것이었다."></a><strong>express의 에러감지를 위해 적용해 놓은 sentry의 Sentry.Handlers.requestHandler 에서 Memory Leak이 발생</strong>한 것이었다.</h5><p>Sentry 코드의 내용을 확인해보면 Node.js의 domain 객체를 사용하는 간단한 코드로 구성되어 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">requestHandler</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">const</span> local = domain.create();</span><br><span class="line">    local.add(req);</span><br><span class="line">    local.add(res);</span><br><span class="line">    local.on(<span class="string">'error'</span>, next);</span><br><span class="line">    local.run(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">       <span class="comment">// ...</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a href="https://github.com/getsentry/sentry-javascript/blob/master/packages/node/src/handlers.ts#L233-L255" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/getsentry/sentry-javascript/blob/master/packages/node/src/handlers.ts#L233-L255</a></p>
</blockquote>
<p>Node.js의 domain 객체에서 <strong>Memory Leak</strong>을 유발하는 코드가 있어서 위와 같은 문제가 발생한다.<br><a href="https://github.com/nodejs/node/pull/26098" rel="external nofollow noopener noreferrer" target="_blank">Node.js 11.10.0 릴리즈 노트</a>를 확인하시면 <a href="https://nodejs.org/api/domain.html#domain_domain" rel="external nofollow noopener noreferrer" target="_blank">domain</a>의 Memory Leak 이슈가 해결된 커멘트를 확인해 볼 수 있다.</p>
<blockquote>
<p>[<a href="https://github.com/nodejs/node/commit/60c5099f4b" rel="external nofollow noopener noreferrer" target="_blank">60c5099f4b</a>] - domain: avoid circular memory references (Anna Henningsen) <a href="https://github.com/nodejs/node/pull/25993" rel="external nofollow noopener noreferrer" target="_blank">#25993</a></p>
</blockquote>
<h4 id="Node-js-11-10-0에서는-domain-객체의-Memory-Leak-문제가-해결되었으나-아직-Node-js-의-LTS-버전은-10-x-x-이기에-사실상-서비스에서는-Sentry-Handlers-requestHandler를-사용할-수-없었다"><a href="#Node-js-11-10-0에서는-domain-객체의-Memory-Leak-문제가-해결되었으나-아직-Node-js-의-LTS-버전은-10-x-x-이기에-사실상-서비스에서는-Sentry-Handlers-requestHandler를-사용할-수-없었다" class="headerlink" title="Node.js 11.10.0에서는 domain 객체의 Memory Leak 문제가 해결되었으나 아직 Node.js 의 LTS 버전은 10.x.x 이기에 사실상 서비스에서는 Sentry.Handlers.requestHandler를 사용할 수 없었다."></a>Node.js 11.10.0에서는 domain 객체의 Memory Leak 문제가 해결되었으나 <br>아직 Node.js 의 LTS 버전은 10.x.x 이기에 사실상 서비스에서는 Sentry.Handlers.requestHandler를 사용할 수 없었다.</h4><p>결과적으로는 Request Header 정보는 서비스 오류, 장애 대응에 크게 문제가 되지 않기에 Express의 Sentry 탐침 코드를 제거하였다.</p>
<blockquote>
<p>참고로 Sentry.Handlers.requestHandler를 적용하지 않으면 아래와 같은 Request Header 정보를 Sentry에서 확인 할 수 없다.</p>
<img src="/blog/2019/06/09/nodejs-memoryleak/requestheader.png">
</blockquote>
<h2 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h2><h3 id="1-Sentry를-사용한다면…"><a href="#1-Sentry를-사용한다면…" class="headerlink" title="1. Sentry를 사용한다면…"></a>1. Sentry를 사용한다면…</h3><ul>
<li><code>Node.js 11.10.0 미만</code>에서는 Sentry.Handlers.requestHandler를 사용하지 않는다.</li>
<li><code>Node.js 11.10.0 이상</code>에서는 Sentry.Handlers.requestHandler를 사용한다.</li>
</ul>
<h3 id="2-node-js-11-10-0-미만-버전에서-domain-객체를-사용하지-않는다"><a href="#2-node-js-11-10-0-미만-버전에서-domain-객체를-사용하지-않는다" class="headerlink" title="2. node.js 11.10.0 미만 버전에서 domain 객체를 사용하지 않는다."></a>2. <code>node.js 11.10.0 미만</code> 버전에서 domain 객체를 사용하지 않는다.</h3><blockquote>
<p>참고로 Node.js의 domain 객체는 node.js 10.x.x에서 deprecated 되었다.</p>
</blockquote>

            

        </div>
    </div>
    <div align="center" style="margin: 30px">
        <a class="bmc-button" style="
        border-radius: 3px;
        text-decoration: none;
        border: 1px solid transparent;
        padding: 9px;
        color: #000000;
        box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5);
        background-color: #FFDD00;" target="_blank" href="https://www.buymeacoffee.com/Tob0c39" rel="external nofollow noopener noreferrer">
            <span style="font-size: 15px;
    padding-left: 28px;
    font-weight: bold;
    background-image: url(https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg);
    background-repeat: no-repeat;
    background-position: 0px;">Buy me a coffee</span>
        </a>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
        <div class="post-footer-tags">
            <span class="text-color-light text-small">TAGGED IN</span><br>
            
    <a class="tag tag--primary tag--small t-link" href="/blog/tags/SSR/">SSR</a> <a class="tag tag--primary tag--small t-link" href="/blog/tags/memoryleak/">memoryleak</a> <a class="tag tag--primary tag--small t-link" href="/blog/tags/nodejs/">nodejs</a> <a class="tag tag--primary tag--small t-link" href="/blog/tags/performance/">performance</a> <a class="tag tag--primary tag--small t-link" href="/blog/tags/sentry/">sentry</a>

        </div>
        
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2019/07/31/object-book1/" data-tooltip="오브젝트 책에 대한 잡담 - 1" aria-label="PREVIOUS: 오브젝트 책에 대한 잡담 - 1">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2019/04/11/fromTodyIamPA/" data-tooltip="오늘부터 나도 FE성능 분석가" aria-label="NEXT: 오늘부터 나도 FE성능 분석가">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://sculove.github.io/blog/2019/06/09/nodejs-memoryleak/" title="Share on Facebook" rel="external nofollow noopener noreferrer">
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="_blank" href="https://twitter.com/intent/tweet?text=http://sculove.github.io/blog/2019/06/09/nodejs-memoryleak/" title="Share on Twitter" rel="external nofollow noopener noreferrer">
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a class="post-action-btn btn btn--default" href="#disqus_thread">
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
        
        <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
        
        
    </div>
</article>

                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2019 sculove. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2019/07/31/object-book1/" data-tooltip="오브젝트 책에 대한 잡담 - 1" aria-label="PREVIOUS: 오브젝트 책에 대한 잡담 - 1">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/blog/2019/04/11/fromTodyIamPA/" data-tooltip="오늘부터 나도 FE성능 분석가" aria-label="NEXT: 오늘부터 나도 FE성능 분석가">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://sculove.github.io/blog/2019/06/09/nodejs-memoryleak/" title="Share on Facebook" rel="external nofollow noopener noreferrer">
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="_blank" href="https://twitter.com/intent/tweet?text=http://sculove.github.io/blog/2019/06/09/nodejs-memoryleak/" title="Share on Twitter" rel="external nofollow noopener noreferrer">
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a class="post-action-btn btn btn--default" href="#disqus_thread">
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a class="share-option-btn" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://sculove.github.io/blog/2019/06/09/nodejs-memoryleak/" rel="external nofollow noopener noreferrer">
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a class="share-option-btn" target="_blank" href="https://twitter.com/intent/tweet?text=http://sculove.github.io/blog/2019/06/09/nodejs-memoryleak/" rel="external nofollow noopener noreferrer">
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/blog/assets/images/sculove.jpeg" alt="Author&#39;s picture">
        
            <h4 id="about-card-name">sculove</h4>
        
            <div id="about-card-bio"><p>아내와 아들 그리고 딸밖에 모르는 남편</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br>
                <p>FrontEnd Developer</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br>
                대한민국/서울
            </div>
        
    </div>
</div>

        
            <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-times"></i></span>
            <a href="https://algolia.com" target="_blank" rel="external nofollow noopener noreferrer" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search" class="form-control input--large search-input" placeholder="Search ">
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">no post found</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://sculove.github.io/blog/2011/05/14/building-rich/">
                            <h3 class="media-heading">빌딩부자들</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    May 14, 2011
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://sculove.github.io/blog/2012/02/19/donot-speak-book/">
                            <h3 class="media-heading">뱀의 뇌에게 말을 걸지마라</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Feb 19, 2012
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://sculove.github.io/blog/2012/02/29/manager-book/">
                            <h3 class="media-heading">만약 고교야구 여자 매니저가 피터드러커를 읽는다면</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Feb 29, 2012
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://sculove.github.io/blog/2012/03/18/myjob-myhappy/">
                            <h3 class="media-heading">내가 하는 일 가슴 설레는 일</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Mar 18, 2012
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://sculove.github.io/blog/2013/11/06/mobile-es5-compatiable/">
                            <h3 class="media-heading">모바일 브라우저 ECMAScript5 지원 현황</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Nov 6, 2013
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://sculove.github.io/blog/2013/12/05/animation-for-performance/">
                            <h3 class="media-heading">애니메이션 성능을 높이는 방법</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Dec 5, 2013
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://sculove.github.io/blog/2014/11/19/How-to-make-a-smooth-animation/">
                            <h3 class="media-heading">How to Make a Smooth Animation</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Nov 19, 2014
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://sculove.github.io/blog/2015/01/16/angular1-for-performance/">
                            <h3 class="media-heading">AngularJS 성능 이슈에 대한 이야기</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 16, 2015
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://sculove.github.io/blog/2015/09/03/Ftp-settings-in-OSX/">
                            <h3 class="media-heading">Anonymous FTP Settings in OSX</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Sep 3, 2015
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://sculove.github.io/blog/2015/09/03/Apache2-settings-in-OSX/">
                            <h3 class="media-heading">Apache2 Settings in OSX</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Sep 3, 2015
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium" data-message-zero="no post found" data-message-one="1 post found" data-message-other="{n} posts found">
                67 posts found
            </p>
        </div>
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/blog/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/blog/assets/js/jquery.js"></script>
<script src="/blog/assets/js/jquery.fancybox.js"></script>
<script src="/blog/assets/js/thumbs.js"></script>
<script src="/blog/assets/js/tranquilpeak.js"></script>
<!--SCRIPTS END-->

    
        <script>
             var disqus_config = function () {
                 this.page.url = 'http://sculove.github.io/blog/2019/06/09/nodejs-memoryleak/';
                 
                    this.page.identifier = '2019/06/09/nodejs-memoryleak/';
                 
             };
            (function() {
                var d = document, s = d.createElement('script');
                var disqus_shortname = 'sculove';
                s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
    


    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.14.1/moment-with-locales.min.js"></script>
    <script src="//cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
    <script>
        var algoliaClient = algoliasearch('0E46FZ0JA2', '01370395a4f67d606d12d489c615c822');
        var algoliaIndex = algoliaClient.initIndex('sculove.github.io');
    </script>


    </body>
</html>
